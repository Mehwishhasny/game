<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2D Shapes Fun</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Comic+Neue:wght@400;700&display=swap');
        
        body {
            font-family: 'Comic Neue', cursive;
            touch-action: manipulation;
            user-select: none;
            -webkit-user-select: none;
            overflow-x: hidden;
            background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Cpath d='M50 50c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10c0 5.523-4.477 10-10 10s-10-4.477-10-10 4.477-10 10-10zM10 10c0-5.523 4.477-10 10-10s10 4.477 10 10-4.477 10-10 10c0 5.523-4.477 10-10 10S0 25.523 0 20s4.477-10 10-10zm10 8c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8zm40 40c4.418 0 8-3.582 8-8s-3.582-8-8-8-8 3.582-8 8 3.582 8 8 8z' /%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        }
        
        .shape-card {
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .shape-card:hover {
            transform: scale(1.05);
        }
        
        .shape-card.selected {
            transform: scale(1.1);
            box-shadow: 0 0 0 4px #10b981, 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        
        .shape-card.correct {
            animation: correct-animation 0.5s;
        }
        
        .shape-card.incorrect {
            animation: incorrect-animation 0.5s;
        }
        
        .target-container {
            animation: pulse 2s infinite;
        }
        
        .shape-display {
            animation: float 3s ease-in-out infinite;
            transition: all 0.3s ease;
        }
        
        .confetti {
            position: fixed;
            width: 15px;
            height: 15px;
            animation: fall linear forwards;
            z-index: 1000;
        }
        
        .star {
            position: absolute;
            animation: star-fall 1s forwards;
            z-index: 100;
        }
        
        @keyframes correct-animation {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.15); background-color: rgba(74, 222, 128, 0.8); }
        }
        
        @keyframes incorrect-animation {
            0%, 100% { transform: scale(1); }
            20%, 60% { transform: translateX(-5px); background-color: rgba(248, 113, 113, 0.8); }
            40%, 80% { transform: translateX(5px); background-color: rgba(248, 113, 113, 0.8); }
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(5deg); }
        }
        
        @keyframes fall {
            to {
                transform: translateY(100vh) rotate(720deg);
            }
        }
        
        @keyframes star-fall {
            0% { transform: translateY(-20px) scale(0); opacity: 0; }
            50% { opacity: 1; transform: translateY(10px) scale(1.2); }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
        
        .progress-bar {
            height: 20px;
            border-radius: 10px;
            background: linear-gradient(to right, #10b981, #059669);
            transition: width 0.5s ease;
        }
        
        .shapes-chart-item {
            transition: all 0.3s;
        }
        
        .shapes-chart-item:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .highlighted {
            transform: scale(1.3) !important;
            filter: brightness(1.3);
            z-index: 10;
            animation: highlight-pulse 0.8s infinite !important;
        }
        
        @keyframes highlight-pulse {
            0%, 100% { transform: scale(1.3); }
            50% { transform: scale(1.5); }
        }
        
        .sound-button {
            background: linear-gradient(to bottom, #10b981, #059669);
            transition: all 0.3s;
            box-shadow: 0 4px 0 #047857;
        }
        
        .sound-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #047857;
        }
        
        .sound-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #047857;
        }
        
        .sound-button:disabled {
            opacity: 0.7;
            transform: none;
            box-shadow: 0 4px 0 #047857;
        }
        
        .tab {
            transition: all 0.3s ease;
        }
        
        .tab.active {
            background-color: rgba(255, 255, 255, 0.3);
            transform: translateY(-5px);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }
        
        .home-button {
            background: linear-gradient(to bottom, #3b82f6, #2563eb);
            transition: all 0.3s;
            box-shadow: 0 4px 0 #1d4ed8;
        }
        
        .home-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #1d4ed8;
        }
        
        .home-button:active {
            transform: translateY(2px);
            box-shadow: 0 2px 0 #1d4ed8;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-green-400 via-emerald-400 to-teal-400 min-h-screen p-4">
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-5xl font-bold mb-2 drop-shadow-lg text-white">2D Shapes Fun</h1>
            <div id="stars-container" class="flex items-center justify-center h-12 mb-2">
                <!-- Stars will appear here -->
            </div>
        </header>

        <!-- Home Button -->
        <div class="absolute top-4 left-4">
            <button id="home-button" class="home-button text-white font-bold py-2 px-4 rounded-full flex items-center gap-2">
                <span>üè†</span>
                <span>Home</span>
            </button>
        </div>

        <!-- Game Tabs -->
        <div class="flex justify-center mb-6">
            <div class="bg-white/20 backdrop-blur-sm rounded-full p-2 shadow-lg">
                <div class="flex gap-2">
                    <button id="tab-1" class="tab active px-6 py-3 rounded-full text-white font-bold">Name the Shape</button>
                    <button id="tab-2" class="tab px-6 py-3 rounded-full text-white font-bold">Match the Object</button>
                </div>
            </div>
        </div>

        <!-- Game Area -->
        <div class="bg-white/30 backdrop-blur-md rounded-3xl p-6 shadow-lg mb-6">
            <div class="flex justify-between items-center mb-4">
                <div class="text-3xl">üéÆ</div>
                <div class="bg-white/30 backdrop-blur-sm rounded-full px-6 py-2 shadow-lg">
                    <div class="flex items-center gap-2">
                        <span class="text-2xl">üèÜ</span>
                        <div class="w-48 bg-white/30 rounded-full overflow-hidden">
                            <div id="game-progress" class="progress-bar w-0"></div>
                        </div>
                        <span id="round-indicator" class="text-white font-bold">1/5</span>
                    </div>
                </div>
            </div>
            
            <!-- Tab 1 Content: Name the Shape -->
            <div id="tab-content-1" class="tab-content active">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">Name the Shape</h2>
                    <p class="text-xl text-white">What shape do you see?</p>
                </div>

                <!-- Target Shape -->
                <div id="target-container-1" class="bg-white/30 rounded-2xl p-6 flex flex-col items-center justify-center gap-4 mb-4 min-h-[200px] target-container">
                    <!-- Target shape will be added here -->
                </div>
                
                <!-- Sound Button -->
                <button id="sound-button-1" class="sound-button text-white font-bold py-3 px-6 rounded-full mx-auto block mb-6 text-xl">
                    <span class="flex items-center gap-2">
                        <span>üîä</span>
                        <span>Hear the shape name</span>
                    </span>
                </button>

                <!-- Shape Options -->
                <div id="shape-options-1" class="flex justify-center gap-10 mb-4">
                    <!-- Shape names will be added here -->
                </div>
            </div>
            
            <!-- Tab 2 Content: Match the Object -->
            <div id="tab-content-2" class="tab-content">
                <div class="text-center mb-6">
                    <h2 class="text-2xl font-bold text-white mb-2">Match the Object</h2>
                    <p class="text-xl text-white">Which shape matches this object?</p>
                </div>

                <!-- Target Object -->
                <div id="target-container-2" class="bg-white/30 rounded-2xl p-6 flex flex-col items-center justify-center gap-4 mb-4 min-h-[200px] target-container">
                    <!-- Target object will be added here -->
                </div>
                
                <!-- Sound Button -->
                <button id="sound-button-2" class="sound-button text-white font-bold py-3 px-6 rounded-full mx-auto block mb-6 text-xl">
                    <span class="flex items-center gap-2">
                        <span>üîä</span>
                        <span>Hear the object description</span>
                    </span>
                </button>

                <!-- Shape Options -->
                <div id="shape-options-2" class="flex justify-center gap-10 mb-4">
                    <!-- Shape options will be added here -->
                </div>
            </div>
        </div>
        
        <!-- Shapes Reference -->
        <div class="bg-white/20 backdrop-blur-md rounded-3xl p-6 shadow-lg">
            <h2 class="text-2xl font-bold text-white mb-4 text-center">Shapes Reference</h2>
            <div id="shapes-reference" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                <!-- Shapes reference will be generated here -->
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div id="feedback-modal" class="fixed inset-0 flex items-center justify-center bg-black/40 z-50 hidden">
        <div class="bg-white rounded-3xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl">
            <div id="feedback-icon" class="mx-auto mb-4 w-24 h-24 flex items-center justify-center rounded-full text-6xl"></div>
            <h3 id="feedback-title" class="text-3xl font-bold mb-4 text-gray-800"></h3>
            <p id="feedback-message" class="text-xl mb-6 text-gray-600"></p>
            <div class="flex flex-col sm:flex-row gap-3 justify-center">
                <button id="feedback-button" class="px-6 py-3 bg-green-500 text-white text-xl rounded-full hover:bg-green-600 transition-colors shadow-lg">Continue</button>
                <button id="try-again-button" class="px-6 py-3 bg-teal-500 text-white text-xl rounded-full hover:bg-teal-600 transition-colors shadow-lg hidden">Let me try again</button>
            </div>
        </div>
    </div>

    <!-- Game Complete Modal -->
    <div id="complete-modal" class="fixed inset-0 flex items-center justify-center bg-black/40 z-50 hidden">
        <div class="bg-white rounded-3xl p-6 max-w-sm w-full mx-4 text-center shadow-2xl">
            <div class="mx-auto mb-4 w-24 h-24 flex items-center justify-center rounded-full bg-green-100 text-6xl">
                üéâ
            </div>
            <h3 class="text-3xl font-bold mb-4 text-gray-800">Great Job!</h3>
            <p id="complete-message" class="text-xl mb-6 text-gray-600">You completed the game!</p>
            <div class="flex flex-col sm:flex-row gap-3 justify-center">
                <button id="play-again-btn" class="px-8 py-3 bg-green-500 text-white text-xl rounded-full hover:bg-green-600 transition-colors shadow-lg">Play Again</button>
                <button id="home-btn" class="px-8 py-3 bg-blue-500 text-white text-xl rounded-full hover:bg-blue-600 transition-colors shadow-lg">Home</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Shapes data - simplified to just basic 2D shapes
            const shapesData = [
                { 
                    name: 'Circle', 
                    svg: `<svg width="150" height="150" viewBox="0 0 150 150">
                            <circle cx="75" cy="75" r="60" fill="#3b82f6" stroke="#1d4ed8" stroke-width="4"/>
                          </svg>`,
                    description: 'A round shape with no corners',
                    objects: [
                        { name: 'Ball', emoji: '‚öΩ' },
                        { name: 'Clock', emoji: 'üï∞Ô∏è' },
                        { name: 'Coin', emoji: 'ü™ô' }
                    ]
                },
                { 
                    name: 'Square', 
                    svg: `<svg width="150" height="150" viewBox="0 0 150 150">
                            <rect x="25" y="25" width="100" height="100" fill="#ef4444" stroke="#b91c1c" stroke-width="4"/>
                          </svg>`,
                    description: 'A shape with 4 equal sides and 4 corners',
                    objects: [
                        { name: 'Gift Box', emoji: 'üéÅ' },
                        { name: 'Dice', emoji: 'üé≤' },
                        { name: 'Block', emoji: 'üß±' }
                    ]
                },
                { 
                    name: 'Triangle', 
                    svg: `<svg width="150" height="150" viewBox="0 0 150 150">
                            <polygon points="75,20 130,120 20,120" fill="#f59e0b" stroke="#b45309" stroke-width="4"/>
                          </svg>`,
                    description: 'A shape with 3 sides and 3 corners',
                    objects: [
                        { name: 'Pizza Slice', emoji: 'üçï' },
                        { name: 'Mountain', emoji: '‚õ∞Ô∏è' },
                        { name: 'Warning Sign', emoji: '‚ö†Ô∏è' }
                    ]
                },
                { 
                    name: 'Rectangle', 
                    svg: `<svg width="150" height="150" viewBox="0 0 150 150">
                            <rect x="25" y="40" width="100" height="70" fill="#10b981" stroke="#047857" stroke-width="4"/>
                          </svg>`,
                    description: 'A shape with 4 sides and 4 corners',
                    objects: [
                        { name: 'Door', emoji: 'üö™' },
                        { name: 'Book', emoji: 'üìï' },
                        { name: 'Phone', emoji: 'üì±' }
                    ]
                },
                { 
                    name: 'Star', 
                    svg: `<svg width="150" height="150" viewBox="0 0 150 150">
                            <polygon points="75,20 90,55 125,55 100,80 110,115 75,95 40,115 50,80 25,55 60,55" fill="#eab308" stroke="#a16207" stroke-width="4"/>
                          </svg>`,
                    description: 'A shape with 5 points',
                    objects: [
                        { name: 'Star in Sky', emoji: '‚≠ê' },
                        { name: 'Magic Wand', emoji: 'ü™Ñ' },
                        { name: 'Medal', emoji: 'üèÖ' }
                    ]
                },
                { 
                    name: 'Heart', 
                    svg: `<svg width="150" height="150" viewBox="0 0 150 150">
                            <path d="M75,130 C35,90 20,65 20,50 C20,35 35,25 50,25 C65,25 75,40 75,40 C75,40 85,25 100,25 C115,25 130,35 130,50 C130,65 115,90 75,130 Z" fill="#dc2626" stroke="#991b1b" stroke-width="4"/>
                          </svg>`,
                    description: 'A shape that represents love',
                    objects: [
                        { name: 'Love Symbol', emoji: '‚ù§Ô∏è' },
                        { name: 'Valentine Card', emoji: 'üíå' },
                        { name: 'Candy', emoji: 'üç¨' }
                    ]
                }
            ];

            // Game state
            let gameState = {
                currentTab: 1,
                currentRound: 0,
                totalRounds: 5, // Reduced to 5 rounds for easier gameplay
                correctAnswers: 0,
                usedShapes: [],
                usedObjects: [],
                stars: 0,
                currentShape: null,
                currentObject: null,
                correctPositions: [] // Track positions for verification
            };

            // DOM elements
            const tab1 = document.getElementById('tab-1');
            const tab2 = document.getElementById('tab-2');
            const tabContent1 = document.getElementById('tab-content-1');
            const tabContent2 = document.getElementById('tab-content-2');
            const targetContainer1 = document.getElementById('target-container-1');
            const targetContainer2 = document.getElementById('target-container-2');
            const shapeOptions1 = document.getElementById('shape-options-1');
            const shapeOptions2 = document.getElementById('shape-options-2');
            const gameProgress = document.getElementById('game-progress');
            const starsContainer = document.getElementById('stars-container');
            const shapesReference = document.getElementById('shapes-reference');
            const feedbackModal = document.getElementById('feedback-modal');
            const feedbackIcon = document.getElementById('feedback-icon');
            const feedbackTitle = document.getElementById('feedback-title');
            const feedbackMessage = document.getElementById('feedback-message');
            const feedbackButton = document.getElementById('feedback-button');
            const tryAgainButton = document.getElementById('try-again-button');
            const completeModal = document.getElementById('complete-modal');
            const completeMessage = document.getElementById('complete-message');
            const playAgainBtn = document.getElementById('play-again-btn');
            const homeBtn = document.getElementById('home-btn');
            const homeButton = document.getElementById('home-button');
            const soundButton1 = document.getElementById('sound-button-1');
            const soundButton2 = document.getElementById('sound-button-2');
            const roundIndicator = document.getElementById('round-indicator');

            // Initialize
            function init() {
                // Generate shapes reference
                generateShapesReference();
                
                // Set up tab switching
                tab1.addEventListener('click', () => switchTab(1));
                tab2.addEventListener('click', () => switchTab(2));
                
                // Set up feedback button
                feedbackButton.addEventListener('click', closeFeedback);
                
                // Set up try again button
                tryAgainButton.addEventListener('click', () => {
                    feedbackModal.classList.add('hidden');
                    if (gameState.currentTab === 1) {
                        enableShapeOptions(shapeOptions1);
                    } else {
                        enableShapeOptions(shapeOptions2);
                    }
                });
                
                // Set up play again button
                playAgainBtn.addEventListener('click', () => {
                    completeModal.classList.add('hidden');
                    startGame();
                });
                
                // Set up home buttons
                homeBtn.addEventListener('click', () => {
                    completeModal.classList.add('hidden');
                    goHome();
                });
                
                homeButton.addEventListener('click', goHome);
                
                // Set up sound buttons
                soundButton1.addEventListener('click', () => {
                    if (gameState.currentShape) {
                        speakText(`This is a ${gameState.currentShape.name}. ${gameState.currentShape.description}`);
                    }
                });
                
                soundButton2.addEventListener('click', () => {
                    if (gameState.currentObject && gameState.currentShape) {
                        speakText(`This is a ${gameState.currentObject.name}. It's shaped like a ${gameState.currentShape.name}.`);
                    }
                });
                
                // Start the game
                startGame();
            }

            // Go home function
            function goHome() {
                window.location.href = "index.html";
            }

            // Generate shapes reference
            function generateShapesReference() {
                shapesReference.innerHTML = '';
                
                shapesData.forEach(shape => {
                    const shapeCard = document.createElement('div');
                    shapeCard.className = 'shapes-chart-item bg-white/80 rounded-xl p-4 flex flex-col items-center justify-center shadow-md';
                    shapeCard.innerHTML = `
                        <div class="mb-2">${shape.svg}</div>
                        <div class="text-xl font-bold text-gray-800">${shape.name}</div>
                        <div class="text-sm text-gray-600">${shape.description}</div>
                    `;
                    
                    // Add click event to play shape sound
                    shapeCard.addEventListener('click', () => {
                        speakText(`This is a ${shape.name}. ${shape.description}`);
                        
                        // Visual feedback
                        shapeCard.classList.add('selected');
                        setTimeout(() => {
                            shapeCard.classList.remove('selected');
                        }, 500);
                    });
                    
                    shapesReference.appendChild(shapeCard);
                });
            }

            // Switch tab
            function switchTab(tabNumber) {
                // Update active tab
                tab1.classList.toggle('active', tabNumber === 1);
                tab2.classList.toggle('active', tabNumber === 2);
                
                // Update active content
                tabContent1.classList.toggle('active', tabNumber === 1);
                tabContent2.classList.toggle('active', tabNumber === 2);
                
                // Update game state
                gameState.currentTab = tabNumber;
                
                // Reset and start new game for the tab
                startGame();
            }

            // Start game
            function startGame() {
                // Reset state
                gameState = {
                    ...gameState,
                    currentRound: 0,
                    totalRounds: 5,
                    correctAnswers: 0,
                    usedShapes: [],
                    usedObjects: [],
                    stars: 0,
                    currentShape: null,
                    currentObject: null,
                    correctPositions: []
                };
                
                starsContainer.innerHTML = '';
                updateProgress();
                nextRound();
            }

            // Next round
            function nextRound() {
                if (gameState.currentRound >= gameState.totalRounds) {
                    showGameComplete();
                    return;
                }
                
                if (gameState.currentTab === 1) {
                    // Name the Shape game
                    setupNameTheShapeRound();
                } else {
                    // Match the Object game
                    setupMatchTheObjectRound();
                }
                
                gameState.currentRound++;
                updateProgress();
                
                // Update round indicator
                roundIndicator.textContent = `${gameState.currentRound}/${gameState.totalRounds}`;
            }
            
            // Setup Name the Shape round
            function setupNameTheShapeRound() {
                // Get a random shape that hasn't been used
                let availableShapes = shapesData.filter(shape => !gameState.usedShapes.includes(shape.name));
                if (availableShapes.length === 0) {
                    gameState.usedShapes = [];
                    availableShapes = [...shapesData];
                }
                
                const randomIndex = Math.floor(Math.random() * availableShapes.length);
                const targetShape = availableShapes[randomIndex];
                gameState.usedShapes.push(targetShape.name);
                gameState.currentShape = targetShape;
                
                // Display target shape
                targetContainer1.innerHTML = '';
                
                const shapeDisplay = document.createElement('div');
                shapeDisplay.className = 'shape-display';
                shapeDisplay.innerHTML = targetShape.svg;
                
                targetContainer1.appendChild(shapeDisplay);
                
                // Create options - with guaranteed random position
                createShapeOptions(targetShape.name, shapeOptions1);
            }
            
            // Setup Match the Object round
            function setupMatchTheObjectRound() {
                // Get a random shape that hasn't been used
                let availableShapes = shapesData.filter(shape => !gameState.usedShapes.includes(shape.name));
                if (availableShapes.length === 0) {
                    gameState.usedShapes = [];
                    availableShapes = [...shapesData];
                }
                
                const randomIndex = Math.floor(Math.random() * availableShapes.length);
                const targetShape = availableShapes[randomIndex];
                gameState.usedShapes.push(targetShape.name);
                gameState.currentShape = targetShape;
                
                // Get a random object for this shape
                const randomObjectIndex = Math.floor(Math.random() * targetShape.objects.length);
                const targetObject = targetShape.objects[randomObjectIndex];
                gameState.currentObject = targetObject;
                
                // Display target object
                targetContainer2.innerHTML = '';
                
                const objectDisplay = document.createElement('div');
                objectDisplay.className = 'flex flex-col items-center justify-center gap-4';
                
                const emojiDisplay = document.createElement('div');
                emojiDisplay.className = 'text-9xl shape-display';
                emojiDisplay.textContent = targetObject.emoji;
                
                const nameDisplay = document.createElement('div');
                nameDisplay.className = 'text-3xl font-bold text-white';
                nameDisplay.textContent = targetObject.name;
                
                objectDisplay.appendChild(emojiDisplay);
                objectDisplay.appendChild(nameDisplay);
                targetContainer2.appendChild(objectDisplay);
                
                // Create shape options - with guaranteed random position
                createShapeOptionsWithSVG(targetShape.name, shapeOptions2);
            }
            
            // Create shape name options with guaranteed random position for correct answer
            function createShapeOptions(correctShapeName, optionsContainer) {
                optionsContainer.innerHTML = '';
                
                // Create array of all possible shape names
                const allShapeNames = shapesData.map(shape => shape.name);
                
                // Remove the correct shape name
                const incorrectShapeNames = allShapeNames.filter(name => name !== correctShapeName);
                
                // Shuffle and take 2 (we want 3 options total - correct + 2 incorrect)
                shuffleArray(incorrectShapeNames);
                const twoIncorrectShapeNames = incorrectShapeNames.slice(0, 2);
                
                // Randomly determine position for correct answer (0, 1, or 2)
                const correctPosition = Math.floor(Math.random() * 3);
                
                // Track positions for verification
                gameState.correctPositions.push(correctPosition);
                
                // Create the final array with the correct shape name in the random position
                const finalOptions = [...twoIncorrectShapeNames];
                finalOptions.splice(correctPosition, 0, correctShapeName);
                
                // Create option elements
                finalOptions.forEach((shapeName, index) => {
                    const shapeCard = document.createElement('div');
                    shapeCard.className = 'shape-card bg-white/80 rounded-xl p-4 flex items-center justify-center shadow-lg text-2xl font-bold text-gray-800 w-32 h-20';
                    shapeCard.textContent = shapeName;
                    shapeCard.dataset.position = index;
                    shapeCard.addEventListener('click', () => checkAnswer(shapeName, correctShapeName, optionsContainer));
                    optionsContainer.appendChild(shapeCard);
                });
                
                // Log the position history (for verification only)
                console.log(`Round ${gameState.currentRound + 1}: Correct answer (${correctShapeName}) is in position ${correctPosition + 1} of 3`);
                console.log("Position history:", gameState.correctPositions);
            }
            
            // Create shape SVG options with guaranteed random position for correct answer
            function createShapeOptionsWithSVG(correctShapeName, optionsContainer) {
                optionsContainer.innerHTML = '';
                
                // Create array of all possible shapes
                const allShapes = [...shapesData];
                
                // Find the correct shape
                const correctShape = allShapes.find(shape => shape.name === correctShapeName);
                
                // Remove the correct shape
                const incorrectShapes = allShapes.filter(shape => shape.name !== correctShapeName);
                
                // Shuffle and take 2 (we want 3 options total - correct + 2 incorrect)
                shuffleArray(incorrectShapes);
                const twoIncorrectShapes = incorrectShapes.slice(0, 2);
                
                // Randomly determine position for correct answer (0, 1, or 2)
                const correctPosition = Math.floor(Math.random() * 3);
                
                // Track positions for verification
                gameState.correctPositions.push(correctPosition);
                
                // Create the final array with the correct shape in the random position
                const finalOptions = [...twoIncorrectShapes];
                finalOptions.splice(correctPosition, 0, correctShape);
                
                // Create option elements
                finalOptions.forEach((shape, index) => {
                    const shapeCard = document.createElement('div');
                    shapeCard.className = 'shape-card bg-white/80 rounded-xl p-4 flex items-center justify-center shadow-lg w-32 h-32';
                    shapeCard.innerHTML = shape.svg;
                    shapeCard.dataset.name = shape.name;
                    shapeCard.dataset.position = index;
                    shapeCard.addEventListener('click', () => checkAnswer(shape.name, correctShapeName, optionsContainer));
                    optionsContainer.appendChild(shapeCard);
                });
                
                // Log the position history (for verification only)
                console.log(`Round ${gameState.currentRound + 1}: Correct answer (${correctShapeName}) is in position ${correctPosition + 1} of 3`);
                console.log("Position history:", gameState.correctPositions);
            }

            // Check answer
            function checkAnswer(selectedShapeName, correctShapeName, optionsContainer) {
                const isCorrect = selectedShapeName === correctShapeName;
                const selectedCard = Array.from(optionsContainer.children).find(card => 
                    card.textContent === selectedShapeName || card.dataset.name === selectedShapeName
                );
                
                if (isCorrect) {
                    selectedCard.classList.add('correct');
                    gameState.correctAnswers++;
                    addStar();
                    
                    if (gameState.currentTab === 1) {
                        speakText(`Yes! This is a ${correctShapeName}!`);
                        showFeedback(true, `Yes! This is a ${correctShapeName}!`);
                    } else {
                        speakText(`Yes! A ${gameState.currentObject.name} is shaped like a ${correctShapeName}!`);
                        showFeedback(true, `Yes! A ${gameState.currentObject.name} is shaped like a ${correctShapeName}!`);
                    }
                } else {
                    selectedCard.classList.add('incorrect');
                    speakText(`Not quite. Let's try again.`);
                    
                    if (gameState.currentTab === 1) {
                        showFeedback(false, `Not quite. This is a ${correctShapeName}.`, true);
                    } else {
                        showFeedback(false, `Not quite. A ${gameState.currentObject.name} is shaped like a ${correctShapeName}.`, true);
                    }
                }
                
                // Disable all options
                disableShapeOptions(optionsContainer);
                
                // Highlight correct answer if wrong
                if (!isCorrect) {
                    const correctCard = Array.from(optionsContainer.children).find(card => 
                        card.textContent === correctShapeName || card.dataset.name === correctShapeName
                    );
                    setTimeout(() => {
                        correctCard.classList.add('selected');
                    }, 500);
                }
            }
            
            // Disable shape options
            function disableShapeOptions(optionsContainer) {
                Array.from(optionsContainer.children).forEach(card => {
                    card.style.pointerEvents = 'none';
                });
            }
            
            // Enable shape options
            function enableShapeOptions(optionsContainer) {
                Array.from(optionsContainer.children).forEach(card => {
                    if (!card.classList.contains('correct')) {
                        card.style.pointerEvents = 'auto';
                        card.classList.remove('incorrect');
                        card.classList.remove('selected');
                    }
                });
            }

            // Update progress
            function updateProgress() {
                const percentage = (gameState.currentRound / gameState.totalRounds) * 100;
                gameProgress.style.width = `${percentage}%`;
            }

            // Add star
            function addStar() {
                if (gameState.stars < 5) {
                    const star = document.createElement('div');
                    star.className = 'star text-3xl';
                    star.textContent = '‚≠ê';
                    star.style.animationDuration = '0.5s';
                    starsContainer.appendChild(star);
                    gameState.stars++;
                }
            }

            // Show feedback
            function showFeedback(isCorrect, message, showTryAgain = false) {
                feedbackModal.classList.remove('hidden');
                
                if (isCorrect) {
                    feedbackIcon.textContent = 'üòÉ';
                    feedbackTitle.textContent = 'Great job!';
                    feedbackTitle.className = 'text-3xl font-bold mb-4 text-green-600';
                    feedbackButton.className = 'px-6 py-3 bg-green-500 text-white text-xl rounded-full hover:bg-green-600 transition-colors shadow-lg';
                    tryAgainButton.classList.add('hidden');
                    createConfetti();
                } else {
                    feedbackIcon.textContent = 'ü§î';
                    feedbackTitle.textContent = 'Try again!';
                    feedbackTitle.className = 'text-3xl font-bold mb-4 text-teal-600';
                    feedbackButton.className = 'px-6 py-3 bg-teal-500 text-white text-xl rounded-full hover:bg-teal-600 transition-colors shadow-lg';
                    
                    if (showTryAgain) {
                        tryAgainButton.classList.remove('hidden');
                    } else {
                        tryAgainButton.classList.add('hidden');
                    }
                }
                
                feedbackMessage.textContent = message;
            }

            // Close feedback
            function closeFeedback() {
                feedbackModal.classList.add('hidden');
                nextRound();
            }

            // Show game complete
            function showGameComplete() {
                completeModal.classList.remove('hidden');
                
                let gameTypeText = gameState.currentTab === 1 ? "shapes" : "shape-object matches";
                completeMessage.textContent = `You identified ${gameState.correctAnswers} out of ${gameState.totalRounds} ${gameTypeText} correctly!`;
                speakText(`Great job! You identified ${gameState.correctAnswers} out of ${gameState.totalRounds} ${gameTypeText} correctly!`);
                createConfetti();
            }

            // Create confetti effect
            function createConfetti() {
                const colors = ['#ff0000', '#ffa500', '#ffff00', '#00ff00', '#0000ff', '#ff00ff'];
                
                for (let i = 0; i < 30; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.width = Math.random() * 15 + 10 + 'px';
                    confetti.style.height = Math.random() * 15 + 10 + 'px';
                    confetti.style.opacity = Math.random() + 0.5;
                    confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 5000);
                }
            }

            // Text-to-speech function
            function speakText(text) {
                if ('speechSynthesis' in window) {
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.rate = 0.9; // Slightly slower for kids
                    utterance.pitch = 1.1; // Slightly higher pitch
                    speechSynthesis.speak(utterance);
                }
            }

            // Utility function to shuffle array
            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }

            // Initialize
            init();
        });
    </script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'967467c4a64cb479',t:'MTc1Mzg3Mzc4Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>
